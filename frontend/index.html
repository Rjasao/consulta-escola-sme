<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta EscolaAberta SP</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<!-- Favicon institucional SME -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="manifest.json">

<style>
  .navbar-toggler { border: none; }
  .navbar-toggler:focus { box-shadow: none; }
  .offcanvas .clear-btn { margin-top: 4px; }
</style>

<div id="ultima-atualizacao" style="font-size:13px;color:#555;margin-bottom:8px;">
  Última atualização: —
</div>

</head>
<body>

<!-- Barra superior com dois menus hambúrguer -->
<nav class="navbar navbar-light bg-light mb-3">
  <div class="container-fluid">
    <!-- Hamburguer ESQUERDO: Filtros -->
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Abrir filtros">
      <span class="navbar-toggler-icon"></span>
    </button>

    <span class="navbar-brand mb-0 h4 ms-2">Consulta EscolaAberta - SP</span>

    <!-- Hamburguer DIREITO: Conectar -->
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#connectSidebar" aria-controls="connectSidebar" aria-label="Abrir conectar">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<div class="container">

  <!-- Campo fixo de busca por Nome da Escola -->
  <div class="mb-2">
    <label for="search" class="form-label"> <!--Nome da Escola -->
      
      <span class="ms-3" id="codigo-ue-wrap">
        <strong>Código da UE:</strong> <span id="codigo-ue-label">—</span>
         <strong class="ms-3">Mod:</strong> <span id="mod-label">—</span>
        </span>

      </label>
    <div class="input-group">
      <input type="text" id="search" class="form-control" placeholder="Nome da Escola">
    </div>
  </div>

  <!-- Demais filtros (aparecem conforme seleção no menu) -->
  <div class="mb-2 filter-field" data-filter="page" style="display:none;">
    <label for="page" class="form-label">Número da página</label>
    <div class="input-group">
      <input type="number" id="page" class="form-control" placeholder="nº da página">
      <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="page">Apagar</button>
    </div>
  </div>

  <div class="mb-2 filter-field" data-filter="dre" style="display:none;">
    <label for="dre" class="form-label">DRE</label>
    <div class="input-group">
      <input type="text" id="dre" class="form-control" placeholder="DRE">
      <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="dre">Apagar</button>
    </div>
  </div>

  <div class="mb-2 filter-field" data-filter="tipoesc" style="display:none;">
    <label for="tipoesc" class="form-label">Tipo de Escolas</label>
    <div class="input-group">
      <input type="text" id="tipoesc" class="form-control" placeholder="Tipo de Escolas">
      <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="tipoesc">Apagar</button>
    </div>
  </div>

  <div class="mb-2 filter-field" data-filter="distrito" style="display:none;">
    <label for="distrito" class="form-label">Distrito</label>
    <div class="input-group">
      <input type="text" id="distrito" class="form-control" placeholder="Distrito">
      <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="distrito">Apagar</button>
    </div>
  </div>

  <div class="mb-2 filter-field" data-filter="bairro" style="display:none;">
    <label for="bairro" class="form-label">Bairro</label>
    <div class="input-group">
      <input type="text" id="bairro" class="form-control" placeholder="Bairro">
      <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="bairro">Apagar</button>
    </div>
  </div>

  <div class="mb-2 filter-field" data-filter="subpref" style="display:none;">
    <label for="subpref" class="form-label">Subprefeitura</label>
    <div class="input-group">
      <input type="text" id="subpref" class="form-control" placeholder="Subprefeitura">
      <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="subpref">Apagar</button>
    </div>
  </div>

  <!-- Botões de busca e limpar -->
  <div class="mb-3 d-flex justify-content-between gap-2">
    <button class="search-btn btn btn-success flex-fill" id="btn-search-schools">Buscar</button>
    <button class="clear-btn btn btn-outline-secondary" id="btn-clear-all">Apagar busca</button>
  </div>

  <!-- Painel de resultados (inicialmente oculto) -->
  <div id="results-panel" class="results-panel mt-3" hidden>
    <div id="results"></div>
<!-- Painel MODE (abaixo do results-panel) -->
<div id="mode-panel" class="mt-3" hidden class="mt-3 border border-success rounded p-2">
  <div id="mode-scroll" class="exscrollbox bg-lightgreen"></div>
</div>
  </div>

</div>

<!-- Offcanvas ESQUERDO: Filtros -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebar" aria-labelledby="sidebarLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="sidebarLabel">Filtros de busca</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-search" data-filter="search" checked disabled>
      <label class="form-check-label" for="check-search">Nome da Escola</label>
    </div>
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-page" data-filter="page">
      <label class="form-check-label" for="check-page">Número da página</label>
    </div>
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-dre" data-filter="dre">
      <label class="form-check-label" for="check-dre">DRE</label>
    </div>
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-tipoesc" data-filter="tipoesc">
      <label class="form-check-label" for="check-tipoesc">Tipo de Escolas</label>
    </div>
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-distrito" data-filter="distrito">
      <label class="form-check-label" for="check-distrito">Distrito</label>
    </div>
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-bairro" data-filter="bairro">
      <label class="form-check-label" for="check-bairro">Bairro</label>
    </div>
    <div class="form-check mb-2">
      <input class="form-check-input filter-check" type="checkbox" id="check-subpref" data-filter="subpref">
      <label class="form-check-label" for="check-subpref">Subprefeitura</label>
    </div>

    <hr>
    <h6>Campos do resultado</h6>

    <!-- Campos default -->
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-codesc" data-field="codesc" checked>
        <label class="form-check-label" for="field-codesc">Código da EU</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-situacao" data-field="situacao" checked>
        <label class="form-check-label" for="field-situacao">Situação</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-rede" data-field="rede" checked>
        <label class="form-check-label" for="field-rede">Rede</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-nomesc" data-field="nomesc" checked>
        <label class="form-check-label" for="field-nomesc">Nome da UE</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dre" data-field="dre" checked>
        <label class="form-check-label" for="field-dre">DRE</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-diretoria" data-field="diretoria" checked>
        <label class="form-check-label" for="field-diretoria">Diretoria</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-distrito" data-field="distrito" checked>
        <label class="form-check-label" for="field-distrito">Distrito</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-endereco" data-field="endereco" checked>
        <label class="form-check-label" for="field-endereco">End.</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-numero" data-field="numero" checked>
        <label class="form-check-label" for="field-numero">Nº</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-bairro" data-field="bairro" checked>
        <label class="form-check-label" for="field-bairro">Bairro</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-cep" data-field="cep" checked>
        <label class="form-check-label" for="field-cep">CEP</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-tel1" data-field="tel1" checked>
        <label class="form-check-label" for="field-tel1">Tel. 01</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-tel2" data-field="tel2" checked>
        <label class="form-check-label" for="field-tel2">Tel. 02</label>
    </div>

    <!-- Campos adicionais -->
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-email" data-field="email">
        <label class="form-check-label" for="field-email">Email</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-nomescofi" data-field="nomescofi">
        <label class="form-check-label" for="field-nomescofi">Nome da UE Cofi</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-subpref" data-field="subpref">
        <label class="form-check-label" for="field-subpref">Subprefeitura</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-coddist" data-field="coddist">
        <label class="form-check-label" for="field-coddist">Cod Distrito</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-setor" data-field="setor">
        <label class="form-check-label" for="field-setor">Setor</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-codinep" data-field="codinep">
        <label class="form-check-label" for="field-codinep">Codigo Nep</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-cd_cie" data-field="cd_cie">
        <label class="form-check-label" for="field-cd_cie">CD CIE</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-eh" data-field="eh">
        <label class="form-check-label" for="field-eh">EH</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dt_criacao" data-field="dt_criacao">
        <label class="form-check-label" for="field-dt_criacao">Data da Criação</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-ato_criacao" data-field="ato_criacao">
        <label class="form-check-label" for="field-ato_criacao">Ato da Criação</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dom_criacao" data-field="dom_criacao">
        <label class="form-check-label" for="field-dom_criacao">Dom. da Criação</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dt_ini_conv" data-field="dt_ini_conv">
        <label class="form-check-label" for="field-dt_ini_conv">Data inicio da Conv.</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dt_ini_func" data-field="dt_ini_func">
        <label class="form-check-label" for="field-dt_ini_func">Data inicio da Func.</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dt_autoriza" data-field="dt_autoriza">
        <label class="form-check-label" for="field-dt_autoriza">Data inicio da Autorização</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-dt_extintao" data-field="dt_extintao">
        <label class="form-check-label" for="field-dt_extintao">Data da Extinção</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-nome_ant" data-field="nome_ant">
        <label class="form-check-label" for="field-nome_ant">Nome Anterior</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-latitude" data-field="latitude">
        <label class="form-check-label" for="field-latitude">Latitude</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-longitude" data-field="longitude">
        <label class="form-check-label" for="field-longitude">Longitude</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-database" data-field="database">
        <label class="form-check-label" for="field-database">Data Base</label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input field-check" type="checkbox" id="field-ceu" data-field="ceu">
        <label class="form-check-label" for="field-ceu">CEU</label>
    </div>

  </div>
</div>

<!-- Offcanvas DIREITO: Conectar -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="connectSidebar" aria-labelledby="connectSidebarLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="connectSidebarLabel">Conectar à API</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">

    <div class="mb-2">
      <label for="consumer_key" class="form-label">Chave do Consumidor</label>
      <div class="input-group">
        <input type="text" id="consumer_key" class="form-control">
        <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="consumer_key">Apagar</button>
      </div>
    </div>

    <div class="mb-2">
      <label for="consumer_secret" class="form-label">Segredo do Consumidor</label>
      <div class="input-group">
        <input type="text" id="consumer_secret" class="form-control">
        <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="consumer_secret">Apagar</button>
      </div>
    </div>

    <div class="mb-2">
      <button id="btn-save-keys" class="btn btn-info w-100">Salvar Chaves</button>
    </div>

    <div class="mb-2">
      <label for="access_token" class="form-label">Token de Acesso</label>
      <div class="input-group">
        <input type="text" id="access_token" class="form-control" readonly>
        <button class="clear-btn btn btn-sm btn-outline-secondary" data-target="access_token">Apagar</button>
      </div>
    </div>

    <div class="mb-2">
      <button id="btn-connect" class="btn btn-primary w-100">Conectar</button>
    </div>

    <!-- NOVA SEÇÃO: Itens a consultar (checkbox exclusivo) -->
    <hr>
    <h6>--------- Itens a consultar ---------</h6>
    <div id="consulta-options">
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-alunosserieturno" value="alunosserieturno">
        <label class="form-check-label" for="chk-alunosserieturno">Alunos/Serie/Turno</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-ambientesbyescola" value="ambientesbyescola">
        <label class="form-check-label" for="chk-ambientesbyescola">Ambientes da escola</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-modalidades" value="modalidades">
        <label class="form-check-label" for="chk-modalidades">Modalidades</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-seriesestudantes" value="seriesestudantes">
        <label class="form-check-label" for="chk-seriesestudantes">Series estudantes</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-servatuacao" value="servatuacao">
        <label class="form-check-label" for="chk-servatuacao">Servico e atuacao</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-servidores" value="servidores">
        <label class="form-check-label" for="chk-servidores">Servidores</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-totservatuacao" value="totservatuacao">
        <label class="form-check-label" for="chk-totservatuacao">Total de servidores/atuacao</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-totservescolarizacao" value="totservescolarizacao">
        <label class="form-check-label" for="chk-totservescolarizacao">Total de servidores/escolarizacao</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-totvagmatbyserie" value="totvagmatbyserie">
        <label class="form-check-label" for="chk-totvagmatbyserie">Total vagas/matriculas por serie</label>
      </div>
      <div class="form-check mb-1">
        <input type="checkbox" class="form-check-input consulta-check" id="chk-turmaserieturno" value="turmaserieturno">
        <label class="form-check-label" for="chk-turmaserieturno">Turma/Serie/Turno</label>
      </div>
    </div>

  </div>
</div>

<div id="toast" class="toast position-fixed bottom-0 end-0 m-3 p-2 rounded" style="display:none; color:white;"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="script.js"></script>
<script src="grid.js"></script>
<script src="maps/maps.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    Grid.init(); // target padrão: #grid-panel
  });
</script>

<script>
(function() {
  function byId(id){ return document.getElementById(id); }
  function bothLabelsHaveValue() {
    const cod = byId("codigo-ue-label")?.textContent?.trim() || "—";
    const mod = byId("mod-label")?.textContent?.trim() || "—";
    return (cod !== "—" && cod.length > 0) && (mod !== "—" && mod.length > 0);
  }
  function updateModePanel() {
    const panel = byId("mode-panel");
    if (!panel) return;
    panel.hidden = !bothLabelsHaveValue();
  }
  document.addEventListener("DOMContentLoaded", updateModePanel);
  if (window.MutationObserver) {
    const codEl = byId("codigo-ue-label");
    const modEl = byId("mod-label");
    const obs = new MutationObserver(updateModePanel);
    if (codEl) obs.observe(codEl, { childList: true, characterData: true, subtree: true });
    if (modEl) obs.observe(modEl, { childList: true, characterData: true, subtree: true });
  }
})();

</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("✅ Service Worker registrado!"))
    .catch(err => console.log("❌ Erro ao registrar:", err));
}
</script>

</body>
</html>
